# GitHub MCPサーバの脆弱性とToxic Agent Flow

## 概要
Invariant社のブログ記事「GitHub MCP Exploited: Accessing private repositories via MCP」では、GitHub MCPサーバにおける深刻な脆弱性が報告されています。この脆弱性は、パブリックリポジトリのIssueを悪用し、MCPエージェントを間接的に操作することで、プライベートリポジトリの情報が漏洩する「Toxic Agent Flow（有害なエージェントフロー）」を引き起こすものです。

## 攻撃の流れ
1. ユーザーはGitHub MCPサーバと連携したMCPクライアント（例：Claude Desktop）を利用。
2. 攻撃者は、誰でもIssueを作成できるパブリックリポジトリに、悪意あるプロンプトインジェクションを含むIssueを投稿。
3. ユーザーが「パブリックリポジトリのIssueを確認して」とMCPエージェントに依頼すると、エージェントはそのIssueを読み込み、攻撃者の意図したプロンプトに従ってプライベートリポジトリの情報を取得・漏洩する。
4. 具体的には、プライベートリポジトリの情報をパブリックリポジトリのPRとして公開し、攻撃者が自由に閲覧できる状態となる。

## 技術的背景
- MCPツール自体が改ざんされていなくても発生する。
- エージェントが「外部からの信頼できない情報（Issue）」を無批判に処理し、ツール呼び出しを自律的に行うことで成立する。
- 「Always Allow」など自動承認設定のユーザーは特にリスクが高い。

## セキュリティ上の論点
- 「Toxic Agent Flow」とは、間接的なプロンプトインジェクションにより、エージェントが本来意図しない危険な一連のツール操作を実行してしまう現象。
- MCPのようなエージェント連携システムでは、外部入力（IssueやPRなど）を通じた攻撃経路が新たなリスクとなる。
- 既存の「ツール自体の改ざん検知」だけでは不十分であり、「エージェントの行動文脈」全体を監視・制御する必要がある。

## 批判的視点・反証
- 記事は「自動承認設定のユーザーが多い」としているが、実際の運用現場では手動承認が主流の場合も多い。リスク評価は運用ポリシー次第で変動する。
- 一方で、今後エージェントの自律性が高まるにつれ、こうした「間接的な攻撃経路」は確実に増加するため、早期の対策が求められる。

## 関連ノート・リンク案
- [[MCPとは何か]]
- [[MCPサーバ_Resource_Prompt_Tool]]

---
#github #mcp #security


[//begin]: # "Autogenerated link references for markdown compatibility"
[MCPとは何か]: MCP%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B.md "MCP（Model Context Protocol）とは何か"
[MCPサーバ_Resource_Prompt_Tool]: MCP%E3%82%B5%E3%83%BC%E3%83%90_Resource_Prompt_Tool.md "MCPサーバのResource・Prompt・Toolとは何か"
[//end]: # "Autogenerated link references"
