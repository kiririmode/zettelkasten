# MCPサーバにおけるrootsとは何か

## 概要
MCPサーバにおける「roots」とは、クライアントがサーバに対して「このリソースや場所に注目してほしい」と提案するURI（Uniform Resource Identifier）のことです。主にファイルシステムのパスが使われますが、HTTP URLなど有効なURIであれば何でも指定できます。

## rootsの役割と意義
- サーバに対して「どのリソースが作業対象か」を明示的に伝えるガイダンスの役割を果たします。
- rootsを使うことで、サーバは「どこまでがワークスペースか」「どのリソースを優先的に扱うべきか」を明確に把握できます。
- 複数のrootsを指定することで、例えばローカルのプロジェクトディレクトリと外部APIエンドポイントを同時に扱う、といった柔軟な運用が可能です。

## 仕組み
1. クライアントは接続時に「roots」機能をサポートしていることを宣言します。
2. クライアントはサーバに対して、注目してほしいroots（URIのリスト）を送信します。
3. rootsが変更された場合は、その旨をサーバに通知します（対応している場合）。

サーバ側は、受け取ったrootsを尊重し、指定された範囲内のリソースを優先的に扱うことが推奨されます。

## 具体例
```json
{
  "roots": [
    {
      "uri": "file:///home/user/projects/frontend",
      "name": "Frontend Repository"
    },
    {
      "uri": "https://api.example.com/v1",
      "name": "API Endpoint"
    }
  ]
}
```
この例では、サーバはローカルのフロントエンドリポジトリと外部APIエンドポイントの両方を作業対象として扱うことになります。

## クライアントがrootsを使う具体的なタイミング・例

### 1. IDEやエディタでプロジェクトを開くとき
- 例：VSCodeやFoamなどのクライアントが、ユーザーのローカルディレクトリ（例：`file:///Users/xxx/projectA`）をワークスペースとして開く際、そのディレクトリをrootsとしてMCPサーバに通知する。
- 複数のプロジェクトやモノレポ（monorepo）を同時に扱う場合、各ディレクトリをrootsに追加することで、サーバ側も全体を把握できる。

### 2. クラウド・ローカル混在の作業環境
- 例：ローカルのプロジェクトディレクトリと、クラウド上のAPIエンドポイントやリモートストレージ（例：`https://api.example.com/v1`）を同時に作業対象としたい場合、両方をrootsに指定する。
- これにより、サーバは両方のリソースを横断的に扱える。

### 3. アクセス権限や作業範囲の明示
- 例：チーム開発で「このサブディレクトリだけをAIエージェントに操作させたい」とき、該当ディレクトリのみをrootsに指定することで、意図しないファイル操作や情報漏洩を防ぐ。

### 4. RedmineやPipedreamなど外部サービス連携
- 例：Redmineの特定プロジェクトAPIやPipedreamのワークフローエンドポイントをrootsに指定し、AIエージェントがその範囲内でのみ操作・連携するよう制御する。

---

#### 具体的なJSON例
```json
{
  "roots": [
    { "uri": "file:///Users/xxx/projectA", "name": "ProjectA" },
    { "uri": "file:///Users/xxx/projectB", "name": "ProjectB" },
    { "uri": "https://api.example.com/v1", "name": "External API" }
  ]
}
```

---

### 反証的視点・rootsを使わない場合の課題
- サーバがどのリソースを優先的に扱うべきか分からず、無関係なファイルやAPIまで誤って操作するリスクが高まる。
- 作業範囲が曖昧になり、セキュリティやパフォーマンスの観点で問題が生じやすい。
- rootsを明示することで、クライアントとサーバ間の責任範囲・意図が明確になり、トラブルを未然に防げる。

## 批判的視点・注意点
- rootsは「推奨」範囲であり、厳密な制約ではありません。サーバはroots外のリソースも扱える場合がありますが、原則としてroots内を優先すべきです。
- rootsの指定が曖昧だったり、不要に多い場合は、サーバのリソース管理やパフォーマンスに悪影響を及ぼす可能性があります。
- rootsの可用性（アクセス可能かどうか）を常に監視し、変更や障害に柔軟に対応することが求められます。

## 関連ノート
- [[MCPとは何か]]

## 関連サイト

- [ここはMCPの夜明け前](https://speakerdeck.com/nwiizo/kokohamcpnoye-ming-kemae)

## まとめ
MCPサーバにおけるrootsは、「どこを作業対象とするか」をクライアントがサーバに伝えるためのURIリストであり、プロジェクトの境界やリソースの優先順位を明確にするための重要な仕組みです。

#modelcontextprotocol #ai/mcp #roots #設計パターン


[//begin]: # "Autogenerated link references for markdown compatibility"
[MCPとは何か]: MCP%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B.md "MCP（Model Context Protocol）とは何か"
[//end]: # "Autogenerated link references"
