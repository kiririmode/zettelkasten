# 等分散性の検定方法

## 定義・概要

等分散性の検定とは、2つ以上のグループの母集団分散が等しい（homoscedasticity）という仮定が成り立つかどうかを統計的に評価する手法である。t検定や分散分析（ANOVA）など多くの統計手法では、グループ間の分散が等しいことが前提となるため、事前にこの仮定を検証することが重要である。

## 主な検定手法

### Levene検定
Levene検定は、グループごとの分布が正規分布でなくても比較的ロバストに等分散性を評価できる方法である。各グループの中央値または平均値からの絶対偏差を用いて分散の等しさを検定する。実務では最もよく用いられる。

- **帰無仮説**：すべてのグループの分散は等しい
- **対立仮説**：いずれかのグループの分散が異なる
- **p値が有意水準未満**なら等分散性は棄却される

### F検定
F検定は2群の分散が等しいかを検定する伝統的な方法である。ただし、各グループが正規分布に従うことが前提となるため、外れ値や非正規分布に弱い。

- **帰無仮説**：2群の分散は等しい
- **対立仮説**：2群の分散は等しくない
- **F値**と**p値**を算出し、有意水準と比較する

## Pythonによる実装例

以下は、Levene検定およびF検定を用いて「等分散性の帰無仮説が棄却される」ケースを示す例である。2群の分散が明らかに異なるデータを用いることで、p値が有意水準（例：0.05）未満となり、等分散性の仮定が棄却されることを確認できる。

```python
import numpy as np
from scipy.stats import levene

# 例：分散が大きく異なる2群のデータ
group1 = [10, 12, 11, 13, 12, 11, 10, 12, 13, 11]
group2 = [20, 35, 22, 38, 25, 40, 19, 36, 21, 39]

# Levene検定
stat, p = levene(group1, group2)
print(f"Levene検定 p値: {p:.3f}")
if p < 0.05:
    print("→ 有意水準5%で等分散性の帰無仮説は棄却される（分散は等しくないと判断）")
else:
    print("→ 等分散性の帰無仮説は棄却されない（分散は等しいとみなせる）")

# F検定（分散比）
var1 = np.var(group1, ddof=1)
var2 = np.var(group2, ddof=1)
F = var1 / var2 if var1 > var2 else var2 / var1
print(f"F値: {F:.3f}")
# F検定のp値計算はscipyには直接ないが、分散比が大きい場合は等分散性が疑われる
```

この例では、group2の分散がgroup1よりも明らかに大きいため、Levene検定のp値は0.05未満となり、等分散性の帰無仮説が棄却される（=分散が等しくないと判断される）ことが期待される。

## Levene検定とF検定の比較

| 検定手法   | メリット                                                                 | デメリット                                                                                 |
|------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| Levene検定 | ・分布の正規性にあまり依存せずロバスト<br>・外れ値の影響が比較的小さい         | ・サンプルサイズが極端に小さい場合は不安定<br>・中央値/平均値の選択で結果が変わることも |
| F検定      | ・計算がシンプルで伝統的な手法<br>・2群の分散比較に特化                     | ・正規分布の仮定に非常に敏感<br>・外れ値や非正規分布に弱い                              |

## 等分散性の検定が必要となる主なユースケース

等分散性の検定は、以下のような場面で必要不可欠となる。

- **t検定（二標本t検定、対応のないt検定）**
  - 2つのグループの平均値を比較する際、分散が等しいかどうかで検定手法（Studentのt検定かWelchのt検定か）が変わるため、事前に等分散性の検定が必要。
- **分散分析（ANOVA）**
  - 3群以上の平均値を比較する分散分析では、各群の分散が等しいことが前提となる。等分散性が成り立たない場合、ANOVAの結果の信頼性が損なわれる。
- **回帰分析の残差検定**
  - 回帰モデルの残差が等分散（ホモスケダスティシティ）であるかどうかを確認することで、モデルの仮定が満たされているかを評価できる。
- **品質管理や工業統計**
  - 複数の生産ラインや工程のばらつき（分散）が等しいかどうかを検証し、工程間の安定性や均質性を評価する際に用いられる。
- **医療・臨床試験**
  - 薬剤群とプラセボ群など、複数の治療群間で効果のばらつきが等しいかを確認し、適切な統計手法を選択する根拠とする。

このように、等分散性の検定は「グループ間の平均値や効果の差を比較するあらゆる統計解析」において、前提条件の確認や適切な手法選択のために広く利用されている。

## 批判的視点・反論

- Levene検定は分布の形状に比較的ロバストだが、サンプルサイズが極端に小さい場合や外れ値が多い場合は結果が不安定になる。
- F検定は正規性の仮定に敏感であり、実データでは誤判定のリスクがある。
- 等分散性が棄却された場合は、等分散を仮定しない検定（ウェルチのt検定など）を選択する必要がある。
- 分散の違いが実務的にどの程度重要か、検定結果だけでなく実際のデータの可視化や専門的判断も重要である。

## 関連ノート・リンク
- [[t検定とt分布の応用.md]]
- [[信頼区間・正規分布仮定の理論と実務]]

#statistics #datascience #statistics/test

[//begin]: # "Autogenerated link references for markdown compatibility"
[t検定とt分布の応用.md]: t%E6%A4%9C%E5%AE%9A%E3%81%A8t%E5%88%86%E5%B8%83%E3%81%AE%E5%BF%9C%E7%94%A8.md "t分布とt検定の実務応用――CI実行時間の例を中心に"
[//end]: # "Autogenerated link references"
