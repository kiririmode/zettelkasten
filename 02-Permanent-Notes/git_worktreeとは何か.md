# git worktreeとは何か

## 概要
`git worktree`は、1つのGitリポジトリから複数のワーキングツリー（作業ディレクトリ）を作成・管理できるコマンドです。従来は1リポジトリ＝1ワーキングツリーでしたが、このコマンドにより、同じリポジトリの異なるブランチを複数ディレクトリで同時に作業できます。

## 目的とユースケース
- **複数ブランチの同時開発**：mainブランチでバグ修正をしつつ、featureブランチで新機能開発を進めるなど、ブランチ切り替えによる作業中断やコンフリクトのリスクを減らせます。
- **ビルドやテストの並行実行**：異なるブランチのビルドやテストを同時に走らせたい場合に有効です。
- **レビューや一時的な作業**：PRレビューや一時的な修正のため、特定のコミットやブランチを一時的に別ディレクトリに展開して作業する用途にも便利です。

## ワーキングツリー・ディレクトリ構成
- 通常のGitリポジトリは「リポジトリ本体（.git）」と「ワーキングツリー（作業ディレクトリ）」が1対1で対応します。
- `git worktree`を使うと、1つのリポジトリ（.gitディレクトリ）に対して、複数のワーキングツリー（作業ディレクトリ）が紐づきます。
- 各ワーキングツリーは、異なるブランチやコミットをチェックアウトした状態で独立して作業できます。

## git worktreeを使った開発の代表的な流れ

### 1. 既存リポジトリの準備
まず、通常通りリポジトリのクローンや作業ディレクトリの用意を行います。

```sh
git clone <リポジトリURL>
cd <リポジトリ名>
```

### 2. 新しいワーキングツリーの追加
新しいブランチや既存ブランチで作業したい場合、`git worktree add`で別ディレクトリにワーキングツリーを作成します。

```sh
git worktree add ../feature-branch feature
# ../feature-branch ディレクトリに feature ブランチの作業環境ができる
```
- 既存ブランチの場合は `git worktree add <パス> <ブランチ名>`
- 新規ブランチを作る場合は `git worktree add -b <新ブランチ名> <パス> <ベースブランチ>`

### 3. 各ワーキングツリーでの作業
それぞれのディレクトリで、通常通り`git add`、`git commit`、`git push`などのコマンドを使って作業します。

```sh
# 例: featureブランチ側で
cd ../feature-branch
# ファイル編集
git add .
git commit -m "新機能追加"
git push origin feature
```

### 4. ワーキングツリーの一覧・管理
現在追加されているワーキングツリーを確認するには：

```sh
git worktree list
```
不要になったワーキングツリーは削除できます：

```sh
git worktree remove ../feature-branch
```
このコマンドは、ワークツリーのディレクトリと管理情報を同時に安全に削除します（本来ワークツリーでないパスは削除されません）。

## 批判的視点・注意点
- **利点**：ブランチ切り替えの手間やリスクを減らし、複数作業の効率化が可能です。
- **注意点**：同じファイルを複数ワーキングツリーで同時編集すると、手動でのマージや競合解決が必要になる場合があります。また、ディスク容量も複数ディレクトリ分消費します。
- **従来との違い**：cloneによる複製よりもディスク効率が良く、管理も容易です。

## 関連ノート・リンク案

---
#git #バージョン管理 
