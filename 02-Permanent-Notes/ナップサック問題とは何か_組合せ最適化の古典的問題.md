# ナップサック問題とは何か：組合せ最適化の古典的問題

## 定義

ナップサック問題（Knapsack Problem）は、組合せ最適化における最も基本的で重要な問題の一つである。限られた容量のナップサック（背負い袋）に、価値と重量が設定された複数のアイテムの中から、総重量が容量を超えないように選択して詰め込み、総価値を最大化する問題である。

この問題は計算複雑性理論において[[NPとは何か_非決定性多項式時間問題クラスの基礎]]クラスに属する代表的な問題として知られており、実世界の多くの資源配分問題のモデルとして応用されている。

## ナップサック問題の数学的定式化

$n$個のアイテムがあり、アイテム$i$には価値$v_i$ と重量$w_i$ が設定されている。ナップサックの容量を$W$とするとき、以下の制約条件下で目的関数を最大化する問題として定式化される。

**目的関数（最大化）：**
$$\max \sum_{i=1}^{n} v_i \cdot x_i$$

**制約条件：**
$$\sum_{i=1}^{n} w_i \cdot x_i \leq W$$
$$x_i \in \{0, 1\} \quad \text{（0-1ナップサック問題の場合）}$$

ここで、$x_i$ は アイテム$i$ を選択するかどうかを表すバイナリ変数である。

## 0-1ナップサック問題の特徴

0-1ナップサック問題は、ナップサック問題の最も基本的な形式であり、各アイテムを「取る」または「取らない」の2択でしか選択できない制約が課せられている。この名称は、決定変数が0（取らない）または1（取る）の値しか取れないことに由来する。

### 0-1ナップサック問題の重要な性質

**NP完全問題である点：** 0-1ナップサック問題はNP完全問題であり、効率的な厳密解法は現在知られていない。問題サイズが大きくなると、全探索による解法は現実的な時間内での実行が困難になる。

**動的計画法による解法：** アイテム数を$n$、容量を$W$とすると、$O(nW)$の時間計算量で最適解を求めることができる。ただし、これは疑似多項式時間アルゴリズムであり、$W$が非常に大きい場合は実用的ではない。

**近似アルゴリズムの存在：** 完全多項式時間近似スキーム（FPTAS）が存在し、任意の精度$\varepsilon$に対して$(1-\varepsilon)$近似解を多項式時間で求めることができる。

## ナップサック問題の変種

### 分割可能ナップサック問題（Fractional Knapsack Problem）

アイテムの一部を取ることが許される変種である。この問題は貪欲法により多項式時間で最適解を求めることができ、各アイテムを価値密度（価値/重量）の高い順にソートし、容量いっぱいまで詰め込む戦略が最適解となる。

### 多重ナップサック問題（Multiple Knapsack Problem）

複数のナップサックが存在し、各アイテムをいずれかのナップサックに割り当てる問題である。より複雑な制約を持ち、実際の物流や資源配分問題により近いモデルとなる。

### 無制限ナップサック問題（Unbounded Knapsack Problem）

各アイテムを無制限に選択できる変種である。同じアイテムを複数個選択することが可能で、動的計画法を用いて$O(nW)$時間で解くことができる。

## 実世界への応用

ナップサック問題は抽象的なモデルでありながら、現実世界の多くの問題に応用できる汎用性を持つ。

**投資ポートフォリオ最適化：** 限られた資金で複数の投資対象から最適な組み合わせを選択する問題として定式化できる。各投資対象の期待リターンを価値、投資額を重量、総予算を容量として扱う。

**プロジェクト選択問題：** 企業が限られた予算や人員の制約下で、複数のプロジェクトから実行すべきものを選択する意思決定問題として応用される。

**カッティングストック問題：** 材料の無駄を最小化しながら必要な部品を切り出す製造業の問題として、ナップサック問題の変種が使用される。

## 計算複雑性理論における位置づけ

0-1ナップサック問題はNP完全問題の代表例として、計算複雑性理論の教育や研究において重要な位置を占めている。リチャード・カープが1972年に発表した「21のNP完全問題」の一つに含まれており、多くの他のNP問題への変換の基点として使用される。

この問題の難しさは、最適解を求めるためには本質的に組合せ爆発を避けることができない点にある。アイテム数が$n$の場合、可能な選択の組み合わせは$2^n$通り存在し、すべてを調べる総当たり法は指数時間を要する。

## 批判的視点と限界

### モデルの単純化による限界

実際の意思決定問題では、アイテム間に相互作用や依存関係が存在することが多い。例えば、ある投資を選択すると他の投資の価値が変化する場合や、複数のプロジェクトを同時に実行することでシナジー効果が生まれる場合などである。標準的なナップサック問題では、このような複雑な関係性を直接モデル化することができない。

### 離散化の問題

現実の問題では、重量や価値が連続値である場合が多いが、ナップサック問題では通常これらを離散化して扱う。この離散化によって情報が失われ、最適解が真の最適解から乖離する可能性がある。

### 確定的モデルの限界

標準的なナップサック問題では、各アイテムの価値と重量が確定的に与えられると仮定している。しかし、実際の投資や事業選択では、将来の価値には不確実性が伴う。この不確実性を考慮したロバストなナップサック問題や確率的ナップサック問題の研究も行われているが、計算複雑性がさらに増大する。

## 関連概念とのつながり

ナップサック問題は[[アムダールの法則とは何か]]で議論される並列化の限界と類似した構造を持つ。両者とも資源の制約下での最適化問題であり、全体的な性能向上には部分的な改善だけでは限界があることを示している。

また、動的計画法を用いた解法は、問題を小さな部分問題に分割して解く手法であり、分割統治法の一種として捉えることができる。この考え方は、複雑な問題を段階的に解決するソフトウェア開発手法にも応用されている。

#knapsack #optimization #np-complete #dynamic-programming #combinatorial-optimization #np


[//begin]: # "Autogenerated link references for markdown compatibility"
[NPとは何か_非決定性多項式時間問題クラスの基礎]: NP%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B_%E9%9D%9E%E6%B1%BA%E5%AE%9A%E6%80%A7%E5%A4%9A%E9%A0%85%E5%BC%8F%E6%99%82%E9%96%93%E5%95%8F%E9%A1%8C%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%9F%BA%E7%A4%8E.md "NPとNP困難：計算複雑性理論の核心概念"
[アムダールの法則とは何か]: %E3%82%A2%E3%83%A0%E3%83%80%E3%83%BC%E3%83%AB%E3%81%AE%E6%B3%95%E5%89%87%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B.md "アムダールの法則とは何か"
[//end]: # "Autogenerated link references"
